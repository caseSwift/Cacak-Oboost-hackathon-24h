<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Creative - Start Bootstrap Theme</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap Icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />
        <!-- SimpleLightbox plugin CSS-->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="static/search/temp.css" th:href="@{search/temp.css}" rel="stylesheet" />
        <script src="https://kit.fontawesome.com/0e262a28d3.js"></script>
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" th:href="@{/home}">OBook</a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto my-2 my-lg-0">

                        <li class="nav-item"><a class="nav-link" th:href="@{/shop}" >Shop</a></li>
                        <li class="nav-item"><a class="nav-link" th:href="@{/auth}">Login</a></li>
                        <li class="nav-item"><a class="nav-link" id="pom" th:href="@{/profile}"><i class="fas fa-user-md"></i>Profil</a></li>
                    </ul>
                </div>
            </div>
        </nav>


        <div id="portfolio">
            <div class="container-fluid p-0">
                <div class="row g-0">
                    <div class="col-lg-4 col-sm-6">
                        <a class="portfolio-box" href="assets/img/portfolio/fullsize/1.png" title="Project Name">
                            <img class="img-fluid" th:src="@{search/1.jpeg}" alt="..." />
                            <div class="portfolio-box-caption">
                                <div class="project-category text-white-50">Hotel F</div>
                                <div class="project-name"><i class="fas fa-star"><p>3</p></i></div>
                            </div>
                        </a>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                        <a class="portfolio-box" href="assets/img/portfolio/fullsize/2.png" title="Project Name">
                            <img class="img-fluid" th:src="@{search/2.jpeg}" alt="..." />
                            <div class="portfolio-box-caption">
                                <div class="project-category text-white-50">Hotel E</div>
                                <div class="project-name"><i class="fas fa-star"><p>4</p></i></div>
                            </div>
                        </a>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                        <a class="portfolio-box" href="assets/img/portfolio/fullsize/3.png" title="Project Name">
                            <img class="img-fluid" th:src="@{search/3.jpeg}" alt="..." />
                            <div class="portfolio-box-caption">
                                <div class="project-category text-white-50">Hotel D</div>
                                <div class="project-name"><i class="fas fa-star"><p>3</p></i></div>
                            </div>
                        </a>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                        <a class="portfolio-box" href="assets/img/portfolio/fullsize/4.png" title="Project Name">
                            <img class="img-fluid" th:src="@{search/4.jpeg}" alt="..." />
                            <div class="portfolio-box-caption">
                                <div class="project-category text-white-50">Hotel B</div>
                                <div class="project-name"><i class="fas fa-star"><p>4</p></i></div>
                            </div>
                        </a>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                        <a class="portfolio-box" href="assets/img/portfolio/fullsize/5.png" title="Project Name">
                            <img class="img-fluid" th:src="@{search/5.jpeg}" alt="..." />
                            <div class="portfolio-box-caption">
                                <div class="project-category text-white-50">Hotel A</div>
                                <div class="project-name"><i class="fas fa-star"><p>5</p></i></div>
                            </div>
                        </a>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                        <a class="portfolio-box" href="assets/img/portfolio/fullsize/6.png" title="Project Name">
                            <img class="img-fluid" th:src="@{search/6.jpeg}" alt="..." />
                            <div class="portfolio-box-caption p-3">
                                <div class="project-category text-white-50">Hotel C</div>
                                <div class="project-name"><i class="fas fa-star"><p>4</p></i></div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>


        <div id="3d-model-wrapper" style="margin-top: 150px">
            <model-viewer id="pan-demo" style="height: 500px; width: 500px; margin-top: 200px;"  camera-controls oncontextmenu="return false;"
                          src="static/male_full_body_ecorche/scene.gltf" th:src="@{male_full_body_ecorche/scene.gltf}" alt="Neil Armstrong's Spacesuit from the Smithsonian Digitization Programs Office and National Air and Space Museum">


            </model-viewer>
                <div id="store" class="alert alert-danger" role="alert">

            </div>
            <a th:href="@{/profile}" class="btn btn-success" style="margin-left: 600px">Posalji zahtev</a>


            <style>
                button{
                    display: none;
                    width: 40px;
                    height: 40px;
                    border-radius: 10px;
                    border: none;
                    background-color: transparent;
                    box-sizing: border-box;
                }
                :not(:defined) > * {
                    display: none;
                }
                /*button[slot="hotspot-head"]{*/
                /*    --min-hotspot-opacity: 0;*/
                /*    background-color: red;*/
                /*}*/

            </style>
            <script type="module">
                const modelViewer = document.querySelector('#pan-demo');
                const tapDistance = 2;
                let panning = false;
                let panX, panY;
                let startX, startY;
                let lastX, lastY;
                let metersPerPixel;

                const startPan = () => {
                    const orbit = modelViewer.getCameraOrbit();
                    const {theta, phi, radius} = orbit;
                    const psi = theta - modelViewer.turntableRotation;
                    metersPerPixel = 0.75 * radius / modelViewer.getBoundingClientRect().height;
                    panX = [-Math.cos(psi), 0, Math.sin(psi)];
                    panY = [
                        -Math.cos(phi) * Math.sin(psi),
                        Math.sin(phi),
                        -Math.cos(phi) * Math.cos(psi)
                    ];
                    modelViewer.interactionPrompt = 'none';
                };

                const movePan = (thisX, thisY) => {
                    const dx = (thisX - lastX) * metersPerPixel;
                    const dy = (thisY - lastY) * metersPerPixel;
                    lastX = thisX;
                    lastY = thisY;

                    const target = modelViewer.getCameraTarget();
                    target.x += dx * panX[0] + dy * panY[0];
                    target.y += dx * panX[1] + dy * panY[1];
                    target.z += dx * panX[2] + dy * panY[2];
                    modelViewer.cameraTarget = `${target.x}m ${target.y}m ${target.z}m`;


                    // This pauses turntable rotation
                    modelViewer.dispatchEvent(new CustomEvent(
                        'camera-change', {detail: {source: 'user-interaction'}}));
                };

                const recenter = (pointer) => {
                    panning = false;
                    if (Math.abs(pointer.offsetX - startX) > tapDistance ||
                        Math.abs(pointer.offsetY - startY) > tapDistance)
                        return;
                    const hit = modelViewer.positionAndNormalFromPoint(pointer.offsetX, pointer.offsetY);
                    if (hit == null){
                        modelViewer.cameraTarget = 'auto auto auto';
                        modelViewer.cameraOrbit = 'auto auto auto';
                        document.getElementById("store").innerText = "Molimo, izaberite deo tela:"
                        document.getElementById("store").classList.add('alert-danger');
                        document.getElementById("store").classList.remove('alert-success');

                    }else{
                        modelViewer.cameraTarget = hit.position.toString();
                        const orbit = modelViewer.getCameraOrbit();
                        const {theta, phi, radius} = orbit;
                        modelViewer.cameraOrbit = theta  * (180/Math.PI) + 'deg ' +   ' auto 10m';
                        // modelViewer.cameraTarget < '-0.049225209943942166m 23.88927450682359m 1.9307737979195192m' && hit > '-0.35208375042706247m 15.679170056267548m 0.6193724366725384m'
                        // Math.abs(theta  * (180/Math.PI)) / 360)
                        document.getElementById("store").innerText += hit.position.y;
                        if( hit.position.y < 23.71183929407632 && hit.position.y > 16.0611566971517){
                            //
                            document.getElementById("store").innerText = "Izabrano: Glava";
                            document.getElementById("store").classList.remove('alert-danger');
                            document.getElementById("store").classList.add('alert-success');


                        }else if(hit.position.y < 11.249142375278929 && hit.position.y > -3.221874402881972 &&
                            hit.position.x < 6.891574850541249 && hit.position.x > -6.260765918667238 &&
                            hit.position.z < -2
                        ){
                            document.getElementById("store").innerText = "Izabrano: Ledja";
                            document.getElementById("store").classList.remove('alert-danger');
                            document.getElementById("store").classList.add('alert-success');


                        }else if(hit.position.y < -4.051387383629895 &&
                            hit.position.x < 6.095513617640155 && hit.position.x > -6.095513617640155){
                            document.getElementById("store").innerText = "Izabrano: Noge";
                            document.getElementById("store").classList.remove('alert-danger');
                            document.getElementById("store").classList.add('alert-success');


                        }else if(hit.position.y < 11.490979325046073 && hit.position.y > -3.8143635239493876 &&
                            hit.position.x > -6.263695897235825 && hit.position.x < 5.2066365550282665 &&
                            hit.position.z > 2){
                            document.getElementById("store").innerText = "Izabrano: Telo";
                            document.getElementById("store").classList.remove('alert-danger');
                            document.getElementById("store").classList.add('alert-success');

                        }else if(hit.position.y < 11.416327526053651 && hit.position.y > -15.984323264160869 &&(
                            hit.position.x > 5.791316359131073 && hit.position.x < 13.491267518826069) ||
                            hit.position.x  < -6.433863305464474 && hit.position.x > -13.144150814645126){
                            document.getElementById("store").innerText = "Izabrano: Ruke";
                            document.getElementById("store").classList.remove('alert-danger');
                            document.getElementById("store").classList.add('alert-success');


                        }
                        else{
                            // document.getElementById("store").innerText =  "-------" + hit.position.y + ">>>>" + hit.position.z + ">>>>>>" + hit.position.x;
                            document.getElementById("store").innerText = "Molimo, izaberite deo tela:"
                            document.getElementById("store").classList.add('alert-danger');
                            document.getElementById("store").classList.remove('alert-success');


                        }

                    }
                    // modelViewer.cameraTarget =
                    //     hit == null ? 'auto auto auto' : hit.position.toString();


                };

                modelViewer.addEventListener('mousedown', (event) => {
                    startX = event.offsetX;
                    startY = event.offsetY;
                    panning = event.button === 2 || event.ctrlKey || event.metaKey ||
                        event.shiftKey;
                    if (!panning)
                        return;

                    lastX = startX;
                    lastY = startY;
                    startPan();
                    event.stopPropagation();
                }, true);

                modelViewer.addEventListener('touchstart', (event) => {
                    const {targetTouches, touches} = event;
                    startX = targetTouches[0].offsetX;
                    startY = targetTouches[0].offsetY;
                    panning = targetTouches.length === 2 && targetTouches.length === touches.length;
                    if (!panning)
                        return;

                    lastX = 0.5 * (targetTouches[0].offsetX + targetTouches[1].offsetX);
                    lastY = 0.5 * (targetTouches[0].offsetY + targetTouches[1].offsetY);
                    startPan();
                }, true);

                self.addEventListener('mousemove', (event) => {
                    if (!panning)
                        return;

                    movePan(event.offsetX, event.offsetY);
                    event.stopPropagation();
                }, true);

                modelViewer.addEventListener('touchmove', (event) => {
                    if (!panning || event.targetTouches.length !== 2)
                        return;

                    const {targetTouches} = event;
                    const thisX = 0.5 * (targetTouches[0].offsetX + targetTouches[1].offsetX);
                    const thisY = 0.5 * (targetTouches[0].offsetY + targetTouches[1].offsetY);
                    movePan(thisX, thisY);
                }, true);

                self.addEventListener('mouseup', (event) => {
                    recenter(event);
                }, true);

                modelViewer.addEventListener('touchend', (event) => {
                    if (event.targetTouches.length === 0) {
                        recenter(event.changedTouches[0]);

                        if (event.cancelable) {
                            event.preventDefault();
                        }
                    }
                }, true);


            </script>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>

        <script src="static/search/scripts.js" th:src="@{search/scripts.js}"></script>
        <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    </body>
</html>

